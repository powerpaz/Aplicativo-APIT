<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APIT - Sistema de Análisis de Presencia Institucional</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo-section">
                <i class="fas fa-map-marked-alt"></i>
                <h1>APIT - MINEDUC</h1>
            </div>
            <p class="subtitle">Sistema de Análisis de Presencia Institucional en Territorio</p>
            <p class="legal-ref">Acuerdo Nro. SNP-SNP-2024-0038-A</p>
        </div>
    </header>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Sidebar Controls -->
        <aside class="sidebar">
            <div class="sidebar-section">
                <h3><i class="fas fa-layer-group"></i> Capas Disponibles</h3>
                
                <!-- Capas GeoJSON -->
                <div class="layer-list">
                    <div class="layer-item">
                        <label class="layer-checkbox">
                            <input type="checkbox" id="layer-cantones" checked data-layer="cantones">
                            <span class="layer-name">
                                <i class="fas fa-map" style="color: #3498db;"></i>
                                Cantones (NMTD)
                            </span>
                        </label>
                        <button class="btn-upload-layer" onclick="uploadLayer('cantones')">
                            <i class="fas fa-upload"></i>
                        </button>
                        <input type="file" id="file-cantones" accept=".geojson,.json" style="display:none" onchange="handleLayerUpload(event, 'cantones')">
                    </div>

                    <div class="layer-item">
                        <label class="layer-checkbox">
                            <input type="checkbox" id="layer-establecimientos" data-layer="establecimientos">
                            <span class="layer-name">
                                <i class="fas fa-school" style="color: #e74c3c;"></i>
                                Establecimientos
                            </span>
                        </label>
                        <button class="btn-upload-layer" onclick="uploadLayer('establecimientos')">
                            <i class="fas fa-upload"></i>
                        </button>
                        <input type="file" id="file-establecimientos" accept=".geojson,.json" style="display:none" onchange="handleLayerUpload(event, 'establecimientos')">
                    </div>

                    <div class="layer-item">
                        <label class="layer-checkbox">
                            <input type="checkbox" id="layer-vias" data-layer="vias">
                            <span class="layer-name">
                                <i class="fas fa-road" style="color: #f39c12;"></i>
                                Vías Principales
                            </span>
                        </label>
                        <button class="btn-upload-layer" onclick="uploadLayer('vias')">
                            <i class="fas fa-upload"></i>
                        </button>
                        <input type="file" id="file-vias" accept=".geojson,.json" style="display:none" onchange="handleLayerUpload(event, 'vias')">
                    </div>

                    <div class="layer-item">
                        <label class="layer-checkbox">
                            <input type="checkbox" id="layer-propuesta" data-layer="propuesta">
                            <span class="layer-name">
                                <i class="fas fa-project-diagram" style="color: #9b59b6;"></i>
                                Propuesta NMTD
                            </span>
                        </label>
                        <button class="btn-upload-layer" onclick="uploadLayer('propuesta')">
                            <i class="fas fa-upload"></i>
                        </button>
                        <input type="file" id="file-propuesta" accept=".geojson,.json" style="display:none" onchange="handleLayerUpload(event, 'propuesta')">
                    </div>

                    <div class="layer-item">
                        <label class="layer-checkbox">
                            <input type="checkbox" id="layer-propuesta2" data-layer="propuesta2">
                            <span class="layer-name">
                                <i class="fas fa-sitemap" style="color: #1abc9c;"></i>
                                Propuesta NMTD 2
                            </span>
                        </label>
                        <button class="btn-upload-layer" onclick="uploadLayer('propuesta2')">
                            <i class="fas fa-upload"></i>
                        </button>
                        <input type="file" id="file-propuesta2" accept=".geojson,.json" style="display:none" onchange="handleLayerUpload(event, 'propuesta2')">
                    </div>
                </div>
            </div>

            <!-- Filtros -->
            <div class="sidebar-section">
                <h3><i class="fas fa-filter"></i> Filtros</h3>
                
                <div class="filter-group">
                    <label>Zona de Planificación</label>
                    <select id="filter-zona" onchange="applyFilters()">
                        <option value="">Todas las zonas</option>
                        <option value="UZ1">Zona 1</option>
                        <option value="UZ2">Zona 2</option>
                        <option value="UZ3">Zona 3</option>
                        <option value="UZ4">Zona 4</option>
                        <option value="UZ5">Zona 5</option>
                        <option value="UZ6">Zona 6</option>
                        <option value="UZ7">Zona 7</option>
                        <option value="UZ8">Zona 8</option>
                        <option value="UZ9">Zona 9</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label>Provincia</label>
                    <select id="filter-provincia" onchange="applyFilters()">
                        <option value="">Todas las provincias</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label>Cantón</label>
                    <select id="filter-canton" onchange="applyFilters()">
                        <option value="">Todos los cantones</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label>Año</label>
                    <select id="filter-anio" onchange="applyFilters()">
                        <option value="">Todos</option>
                        <option value="2024">2024</option>
                        <option value="2025">2025</option>
                    </select>
                </div>

                <button class="btn-clear-filters" onclick="clearFilters()">
                    <i class="fas fa-times"></i> Limpiar Filtros
                </button>
            </div>

            <!-- Estadísticas -->
            <div class="sidebar-section">
                <h3><i class="fas fa-chart-bar"></i> Estadísticas</h3>
                <div class="stats-list">
                    <div class="stat-item">
                        <span class="stat-label">Cantones:</span>
                        <span class="stat-value" id="stat-cantones">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Establecimientos:</span>
                        <span class="stat-value" id="stat-establecimientos">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Vías:</span>
                        <span class="stat-value" id="stat-vias">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Filtrados:</span>
                        <span class="stat-value" id="stat-filtrados">0</span>
                    </div>
                </div>
            </div>

            <!-- Acciones -->
            <div class="sidebar-section">
                <h3><i class="fas fa-download"></i> Exportar</h3>
                <button class="btn-action" onclick="exportFilteredData()">
                    <i class="fas fa-file-download"></i> Descargar Filtrados
                </button>
                <button class="btn-action" onclick="exportAllData()">
                    <i class="fas fa-database"></i> Descargar Todo
                </button>
                <button class="btn-action" onclick="exportToExcel()">
                    <i class="fas fa-file-excel"></i> Exportar a Excel
                </button>
            </div>
        </aside>

        <!-- Map Container -->
        <main class="map-container">
            <div id="map"></div>
            
            <!-- Map Controls -->
            <div class="map-controls-overlay">
                <button class="map-btn" onclick="zoomToEcuador()" title="Centrar en Ecuador">
                    <i class="fas fa-home"></i>
                </button>
                <button class="map-btn" onclick="toggleFullscreen()" title="Pantalla completa">
                    <i class="fas fa-expand"></i>
                </button>
                <button class="map-btn" onclick="takeScreenshot()" title="Captura de pantalla">
                    <i class="fas fa-camera"></i>
                </button>
            </div>

            <!-- Loading Indicator -->
            <div id="loading" class="loading-overlay" style="display: none;">
                <div class="loading-spinner">
                    <i class="fas fa-spinner fa-spin"></i>
                    <p>Cargando capa...</p>
                </div>
            </div>

            <!-- Feature Info Panel -->
            <div id="info-panel" class="info-panel" style="display: none;">
                <div class="info-header">
                    <h4><i class="fas fa-info-circle"></i> Información</h4>
                    <button onclick="closeInfoPanel()"><i class="fas fa-times"></i></button>
                </div>
                <div id="info-content" class="info-content"></div>
            </div>
        </main>
    </div>

    <!-- Legend -->
    <div class="legend-container">
        <div class="legend-header" onclick="toggleLegend()">
            <i class="fas fa-list"></i> Leyenda
            <i class="fas fa-chevron-up" id="legend-toggle"></i>
        </div>
        <div id="legend-content" class="legend-content">
            <div class="legend-item">
                <div class="legend-symbol" style="background-color: #3498db; opacity: 0.5;"></div>
                <span>Cantones</span>
            </div>
            <div class="legend-item">
                <div class="legend-symbol circle" style="background-color: #e74c3c;"></div>
                <span>Establecimientos</span>
            </div>
            <div class="legend-item">
                <div class="legend-symbol line" style="background-color: #f39c12;"></div>
                <span>Vías Principales</span>
            </div>
            <div class="legend-item">
                <div class="legend-symbol" style="background-color: #9b59b6; opacity: 0.5;"></div>
                <span>Propuesta NMTD</span>
            </div>
            <div class="legend-item">
                <div class="legend-symbol" style="background-color: #1abc9c; opacity: 0.5;"></div>
                <span>Propuesta NMTD 2</span>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div id="toast-container"></div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <!-- SheetJS for Excel export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <!-- html2canvas for screenshots -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <!-- Custom JS -->
    <script src="app.js"></script>
</body>
</html>
